(function(e){var t=function(e,t){this.options={openDelay:250,closeDelay:500,animIn:"fadeIn",animOut:"fadeOut",animSpeed:"normal",duration:450,wrap:null,direction:"ltr",event:"mouseenter",eventClose:"mouseleave",touch:"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0,offset:0,wcag:1,overlay:0},this.init(e,t)};t.prototype.init=function(t,o){var n=this;if(jQuery.extend(n.options,o),t.length){switch(t.find(".dj-hideitem").remove(),t.find(".modules-wrap ul.nav li.current").each(function(){var t=e(this);t.parents("ul.dj-submenu > li, li.dj-up").each(function(){t.addClass("active").find("> a").addClass("active")})}),n.options.menu=t,n.options.blurTimer=null,n.options.animSpeed){case"fast":n.options.duration=250;break;case"slow":n.options.duration=650}"0"==n.options.animIn&&"0"==n.options.animOut&&(n.options.duration=0),t.addClass(n.options.animSpeed);var i=t.find("li.dj-up");n.kids=[],n.options.wrap=e("#"+n.options.wrap),n.options.wrap.length||(n.options.wrap=t.parents("div").last()),n.options.touch&&t.on("touchstart",function(e){e.stopPropagation()}),i.each(function(t){var o=e(this);n.kids[t]=new s(o,0,n,n.options)}),1==n.options.fixed&&e(window).one("load",n.makeSticky.bind(n,t)),1==n.options.wcag&&(n.focusable=t.find("a[href], [tabindex]"),t.on("keydown",function(e){n.focusNearest(e)}));var a=e("body");e(document).on("djmegamenu:showsubmenu",function(e,t){void 0!==t.options&&1==t.options.overlay&&(a.hasClass("dj-megamenu-overlay")||a.addClass("dj-megamenu-overlay").append('<div class="dj-megamenu-overlay-box" />'))}),e(document).on("djmegamenu:hidesubmenu",function(e,t){void 0!==t.options&&1==t.options.overlay&&setTimeout(function(){"mouseleave"==t.options.eventClose&&t.options.menu.find(".parent.hover").length||a.removeClass("dj-megamenu-overlay").find(".dj-megamenu-overlay-box").remove()},50)})}},t.prototype.focusNearest=function(t){var s=this,o=t.which,n=s.options.menu.find(":focus"),i=n.offset(),a={x:1024,y:1024},u=null;if(i){var r=function(e){if(!e.is(":hidden")&&e!=n){var t=e.offset(),s={x:Math.abs(t.left-i.left),y:Math.abs(t.top-i.top)};37==o&&t.left<i.left||39==o&&t.left>i.left?(s.y<a.y||s.y==a.y&&s.x<a.x)&&(a=s,u=e):(38==o&&t.top<i.top||40==o&&t.top>i.top&&s.x<e.width())&&s.x+s.y<a.x+a.y&&(a=s,u=e)}};s.focusable.each(function(){r(e(this))}),u&&(t.preventDefault(),t.stopPropagation(),u.focus())}},t.prototype.makeSticky=function(t){var s=this;s.sticky=!1;var o=e("#"+t.attr("id")+"sticky"),n=e("<div />");n.css({display:"none",opacity:0,height:t.height()}),n.attr("id",t.attr("id")+"placeholder"),n.insertBefore(o),e(window).scroll(s.scroll.bind(s,o,t,n,!1)),e(window).resize(s.scroll.bind(s,o,t,n,!0)),s.scroll(o,t,n,!1),e(window).on("orientationchange",function(){setTimeout(function(){e(window).trigger("resize")},500)})},t.prototype.scroll=function(t,s,o,n){var i=this;if(!s.is(":hidden")){var a=e(window).scrollTop(),u=(i.sticky?o.offset().top:s.offset().top)-parseInt(i.options.offset);if(i.sticky&&(a<u||n)&&(s.css({position:"",top:"",background:"",width:"",height:""}),s.removeClass("dj-megamenu-fixed"),t.find(".dj-stickylogo").css("display","none"),t.css({position:"",top:"",height:"",left:"",width:"",display:"none"}),o.css({display:"none","min-width":""}),s.find(".dj-up > .dj-subwrap").css({"max-height":"","overflow-y":""}),i.sticky=!1),!i.sticky&&a>=u){t.css({position:"fixed",top:parseInt(i.options.offset),left:0,width:"100%",display:"block"}),o.css({"min-width":s.outerWidth(!0),display:""});var r=0,l=t.find(".dj-stickylogo");l.length&&(l.css("display",""),l.hasClass("dj-align-center")&&(r=l.outerHeight(!0))),s.css({position:"fixed",top:parseInt(i.options.offset)+r,background:"transparent",height:"auto"}),s.addClass("dj-megamenu-fixed"),s.css("width",o.width()?o.width()+1:"auto"),o.css("height",s.outerHeight()),t.css("height",r+s.outerHeight());var d=e(window).height()-parseInt(i.options.offset)-t.height();s.find(".dj-up > .dj-subwrap").each(function(){e(this).find(".dj-subwrap").length||e(this).css({"max-height":d,"overflow-y":"auto"})}),i.sticky=!0}}};var s=function(e,t,s,o){this.options={},this.init(e,t,s,o)};s.prototype.init=function(t,s,o,n){var i=this;jQuery.extend(i.options,n),i.menu=t,i.level=s,i.parent=o,i.timer=null,i.blurTimer=null,i.sub=i.menu.find("> .dj-subwrap").first();var a=i.menu.find(".dj-submenu > li, .dj-subtree > li");a.length||(i.sub.remove(),i.menu.removeClass("parent"),i.menu.find("span.dj-drop").removeClass("dj-drop"),i.menu.find("i.arrow").remove());var u=i.menu.find("> a").first(),r=u.attr("href");r||i.menu.hasClass("separator")||i.menu.addClass("separator"),i.menu.hasClass("separator")&&u.css("cursor","pointer"),(i.options.touch||"click_all"==i.options.event||"click"==i.options.event&&i.menu.hasClass("separator"))&&u.on("touchend click",function(e){i.sub.length&&!i.menu.hasClass("hover")&&(e.preventDefault(),"touchend"==e.type&&i.menu.trigger("click"))}),i.menu.on("click",function(t){var s=e(t.target).closest(".dj-up_a");i.menu.hasClass("hover")?s.length&&(i.menu.hasClass("separator")||"#"===s.attr("href"))&&i.hideSub():i.showSub()}.bind(i)),("mouseenter"==i.options.event||"click"==i.options.event&&!i.menu.hasClass("separator"))&&i.menu.on("mouseenter",function(e){i.showSub()}.bind(i)),(i.options.touch||"click"==i.options.eventClose)&&e(document).on("mouseup",function(t){e(t.target).closest(".dj-megamenu").length||i.hideSub()}),"mouseleave"==i.options.eventClose&&i.menu.on("mouseleave",function(t){e(t.target).is("input")||i.hideSub()}),1==i.options.wcag&&(i.mouse=!1,u.on("mousedown",function(e){i.mouse=!0}),u.on("focus",function(t){i.mouse||e(t.target).is(":hover")||i.showSub()}.bind(i)),u.on("blur",function(t){i.mouse||e(t.target).is(":hover")||(i.mouse=!1,i.blurTimer=setTimeout(function(){if(!i.options.menu.find(":focus").length){for(var e=i;e.level>0;)e.hideSub(),e=e.parent;e.hideSub()}},1e3))}),i.options.menu.on("click",function(){clearTimeout(i.blurTimer)})),i.sub.length&&(i.kids=[],i.initKids())},s.prototype.showSub=function(){var t=this;clearTimeout(t.timer),t.menu.hasClass("hover")&&!t.sub.hasClass(t.options.animOut)||(t.sub.length&&t.sub.css("display","none"),t.timer=setTimeout(function(){clearTimeout(t.animTimer),t.menu.addClass("hover"),t.hideOther(),t.sub.length&&(t.sub.css("display",""),t.sub.removeClass(t.options.animOut),t.checkDir(),t.sub.addClass(t.options.animIn),t.menu.find("> a").attr("aria-expanded","true"),t.menu.trigger("djmegamenu:showsubmenu",[t]),t.sub.find(".modules-wrap").length&&e(window).trigger("resize"))},t.options.openDelay))},s.prototype.hideSub=function(){var e=this;e.menu.hasClass("hover")&&(clearTimeout(e.timer),e.sub.length?e.timer=setTimeout(function(){e.sub.removeClass(e.options.animIn),e.sub.addClass(e.options.animOut),e.animTimer=setTimeout(function(){e.menu.removeClass("hover"),e.menu.find("> a").attr("aria-expanded","false"),e.menu.trigger("djmegamenu:hidesubmenu",[e])},e.options.duration)},e.options.closeDelay):(e.menu.removeClass("hover"),e.menu.find("> a").attr("aria-expanded","false"),e.menu.trigger("djmegamenu:hidesubmenu")))},s.prototype.focusNearest=function(t){var s=this,o=t.which,n=s.menu.offset(),i={x:1024,y:1024},a=null,u=function(e){if(e.menu&&e.menu.find("> a").length){var t=e.menu.offset(),s={x:Math.abs(t.top-n.top),y:Math.abs(t.left-n.left)};37==o&&t.left<n.left||39==o&&t.left>n.left?(s.x<i.x||s.x==i.x&&s.y<i.y)&&(i=s,a=e):(38==o&&t.top<n.top||40==o&&t.top>n.top)&&(s.y<i.y||s.y==i.y&&s.x<i.x)&&(i=s,a=e)}};e.each(s.parent.kids,function(e,t){u(t)}),a||(u(s.parent),s.sub.length&&e.each(s.kids,function(e,t){u(t)})),a&&(t.preventDefault(),t.stopPropagation(),a.menu.find("> a").first().focus())},s.prototype.checkDir=function(){var e=this;if(!e.menu.hasClass("fullsub")){e.sub.css("left",""),e.sub.css("right",""),e.sub.css("margin-left",""),e.sub.css("margin-right","");var t=e.sub.offset(),s=e.options.wrap.offset();if("ltr"==e.options.direction){var o=t.left+e.sub.outerWidth()-e.options.wrap.outerWidth()-s.left;(o>0||e.sub.hasClass("open-left"))&&(e.level?(e.sub.css("right",e.menu.outerWidth()),e.sub.css("left","auto")):e.sub.hasClass("open-left")?(e.sub.css("right",e.sub.css("left")),e.sub.css("left","auto")):e.sub.css("margin-left",-o))}else if("rtl"==e.options.direction){o=t.left-s.left;(o<0||e.sub.hasClass("open-right"))&&(e.level?(e.sub.css("left",e.menu.outerWidth()),e.sub.css("right","auto")):e.sub.hasClass("open-right")?(e.sub.css("left",e.sub.css("right")),e.sub.css("right","auto")):e.sub.css("margin-right",o))}}},s.prototype.initKids=function(){var t=this,o=t.sub.find("> .dj-subwrap-in > .dj-subcol > ul.dj-submenu > li");o.each(function(o){var n=e(this);t.kids[o]=new s(n,t.level+1,t,t.options)})},s.prototype.hideOther=function(){var t=this;e.each(t.parent.kids,function(e,s){s.menu.hasClass("hover")&&s!=t&&(s.sub.length?(s.hideOtherSub(),s.sub.removeClass(s.options.animIn),s.sub.addClass(s.options.animOut),s.animTimer=setTimeout(function(){s.menu.removeClass("hover"),s.menu.find("> a").attr("aria-expanded","false")},t.options.duration)):(s.menu.removeClass("hover"),s.menu.find("> a").attr("aria-expanded","false")))})},s.prototype.hideOtherSub=function(){var t=this;e.each(t.kids,function(e,t){t.sub.length&&(t.hideOtherSub(),t.sub.removeClass(t.options.animIn),t.sub.removeClass(t.options.animOut)),t.menu.removeClass("hover"),t.menu.find("> a").attr("aria-expanded","false")})},e(document).ready(function(){e(".dj-megamenu[data-options]").each(function(){var s=e(this);s.data();var o=s.data("options");s.removeAttr("data-options"),new t(s,o)})})})(jQuery);